{%- comment -%}
  Collection filters sidebar - AJAX enabled
  Usage: {% render 'collection-filters', collection: collection %}
{%- endcomment -%}

<form class="filters-form" data-filters-form>
  <div class="filters-list">
    {%- for filter in collection.filters -%}
      {%- assign active_count = filter.active_values.size -%}
      {%- assign is_price_active = false -%}
      {%- if filter.type == 'price_range' and filter.min_value.value != nil or filter.max_value.value != nil -%}
        {%- assign is_price_active = true -%}
        {%- assign active_count = 1 -%}
      {%- endif -%}
      {%- assign is_open = false -%}
      {%- if active_count > 0 or forloop.index <= 2 -%}
        {%- assign is_open = true -%}
      {%- endif -%}

      <div class="filter-group{% if is_open %} is-open{% endif %}" data-filter-group>
        <button
          type="button"
          class="filter-group__toggle"
          data-filter-toggle-group
          aria-expanded="{% if is_open %}true{% else %}false{% endif %}">
          <span class="filter-group__label">
            {{ filter.label }}
            {%- if active_count > 0 -%}
              <span class="filter-group__active-count collage-badge">{{ active_count }}</span>
            {%- endif -%}
          </span>
          {% render 'icon-chevron-down' %}
        </button>

        <div class="filter-group__content" data-filter-content>
          {%- case filter.type -%}
            {%- when 'list' -%}
              <ul class="filter-group__list" role="list">
                {%- for value in filter.values -%}
                  <li class="filter-option">
                    <label class="filter-option__label-wrap">
                      <input
                        type="checkbox"
                        name="{{ value.param_name }}"
                        value="{{ value.value }}"
                        {% if value.active %}checked{% endif %}
                        {% if value.count == 0 and value.active == false %}disabled{% endif %}
                        data-filter-checkbox
                        aria-describedby="filter-count-{{ filter.label | handleize }}-{{ value.value | handleize }}"
                      >
                      <span class="filter-option__label">{{ value.label }}</span>
                      <span class="filter-option__count" id="filter-count-{{ filter.label | handleize }}-{{ value.value | handleize }}">
                        ({{ value.count }})
                      </span>
                    </label>
                  </li>
                {%- endfor -%}
              </ul>

            {%- when 'price_range' -%}
              <div class="filter-price">
                <div class="filter-price__inputs">
                  <div class="filter-price__field">
                    <span class="filter-price__currency">{{ cart.currency.symbol }}</span>
                    <input
                      type="number"
                      name="{{ filter.min_value.param_name }}"
                      value="{{ filter.min_value.value | money_without_currency | replace: ',', '' }}"
                      min="0"
                      max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                      placeholder="Min"
                      data-filter-price-min
                      aria-label="Precio minimo"
                    >
                  </div>
                  <span class="filter-price__separator">-</span>
                  <div class="filter-price__field">
                    <span class="filter-price__currency">{{ cart.currency.symbol }}</span>
                    <input
                      type="number"
                      name="{{ filter.max_value.param_name }}"
                      value="{{ filter.max_value.value | money_without_currency | replace: ',', '' }}"
                      min="0"
                      max="{{ filter.range_max | money_without_currency | replace: ',', '' }}"
                      placeholder="Max"
                      data-filter-price-max
                      aria-label="Precio maximo"
                    >
                  </div>
                </div>
                {%- if filter.min_value.value != nil or filter.max_value.value != nil -%}
                  <p class="filter-price__active">
                    {{ filter.min_value.value | default: 0 | money }} - {{ filter.max_value.value | default: filter.range_max | money }}
                  </p>
                {%- endif -%}
              </div>
          {%- endcase -%}
        </div>
      </div>
    {%- endfor -%}
  </div>
</form>
