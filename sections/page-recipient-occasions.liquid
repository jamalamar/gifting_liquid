{{ 'page-recipient-occasions.css' | asset_url | stylesheet_tag }}

{%- comment -%}
  Recipient Occasions Page Section
  Shows occasions for a specific recipient (Para Ella / Para Él)
  Links to catalog with pre-selected filters
{%- endcomment -%}

{%- assign recipient_type = section.settings.recipient_type | default: 'para-ella' -%}
{%- assign catalog_url = '/collections/catalogo' -%}

<section class="recipient-page collage-section" data-section-id="{{ section.id }}" data-animate="stagger">

  <!-- Hero Section -->
  <div class="recipient-hero{% if section.settings.hero_image != blank %} recipient-hero--has-image{% endif %}">
    <div class="container">
      <div class="recipient-hero__wrapper">
        <div class="recipient-hero__content">
          <div class="recipient-hero__tag sticker-badge animate-item" style="--i:0">
            {%- if recipient_type == 'para-ella' -%}
              {% render 'icon-heart' %}
            {%- else -%}
              {% render 'icon-star' %}
            {%- endif -%}
            <span>{{ section.settings.tag_text | default: 'Regalos especiales' }}</span>
          </div>
          <h1 class="recipient-hero__title animate-item" style="--i:1">
            {{ section.settings.headline | default: 'Regalos para ella' }}
          </h1>
          <p class="recipient-hero__subtitle animate-item" style="--i:2">
            {{ section.settings.subtitle | default: '¿Cuál es la ocasión especial?' }}
          </p>
        </div>

        {%- if section.settings.hero_image != blank -%}
          <div class="recipient-hero__image animate-item" style="--i:1">
            <img
              src="{{ section.settings.hero_image | image_url: width: 600 }}"
              srcset="{{ section.settings.hero_image | image_url: width: 400 }} 400w,
                      {{ section.settings.hero_image | image_url: width: 600 }} 600w,
                      {{ section.settings.hero_image | image_url: width: 800 }} 800w"
              sizes="(max-width: 749px) 280px, 400px"
              alt="{{ section.settings.headline | default: 'Regalos' }}"
              loading="eager"
              width="{{ section.settings.hero_image.width }}"
              height="{{ section.settings.hero_image.height }}"
            >
          </div>
        {%- endif -%}
      </div>
    </div>

    {%- if section.settings.sticker_hero != blank -%}
      <div class="recipient-sticker recipient-sticker--hero">
        <img src="{{ section.settings.sticker_hero | image_url: width: 150 }}" alt="" loading="lazy">
      </div>
    {%- endif -%}
  </div>

  <!-- Occasions Grid -->
  <div class="recipient-occasions">
    <div class="container">
      <h2 class="recipient-occasions__title animate-item" style="--i:3">
        {{ section.settings.occasions_title | default: 'Elige la ocasión' }}
      </h2>

      <div class="occasion-grid">
        {%- assign card_index = 4 -%}
        {%- for block in section.blocks -%}
          {%- if block.type == 'occasion' -%}
            {%- assign filter_url = catalog_url | append: '?filter.v.tag=recipient:' | append: recipient_type | append: '&filter.v.tag=occasion:' | append: block.settings.tag_value -%}

            <a href="{{ filter_url }}" class="occasion-card animate-item" style="--i:{{ card_index }}" {{ block.shopify_attributes }}>
              <span class="occasion-card__icon">
                {%- if block.settings.icon_image != blank -%}
                  <img src="{{ block.settings.icon_image | image_url: width: 80 }}" alt="{{ block.settings.label }}" loading="lazy">
                {%- else -%}
                  {% render 'icon-gift' %}
                {%- endif -%}
              </span>
              <span class="occasion-card__label">{{ block.settings.label }}</span>
            </a>
            {%- assign card_index = card_index | plus: 1 -%}
          {%- endif -%}
        {%- endfor -%}
      </div>
    </div>

    {%- if section.settings.sticker_occasions != blank -%}
      <div class="recipient-sticker recipient-sticker--occasions">
        <img src="{{ section.settings.sticker_occasions | image_url: width: 140 }}" alt="" loading="lazy">
      </div>
    {%- endif -%}
  </div>

  <!-- See All Link -->
  <div class="recipient-see-all">
    <div class="container">
      {%- assign final_index = card_index -%}
      <p class="recipient-see-all__text animate-item" style="--i:{{ final_index }}">
        {{ section.settings.see_all_text | default: '¿No encuentras la ocasión? No te preocupes.' }}
      </p>
      <a href="{{ catalog_url }}?filter.v.tag=recipient:{{ recipient_type }}" class="btn btn--primary recipient-see-all__link animate-item" style="--i:{{ final_index | plus: 1 }}">
        {%- if recipient_type == 'para-ella' -%}
          Ver todos los regalos para ella
        {%- else -%}
          Ver todos los regalos para él
        {%- endif -%}
        {% render 'icon-arrow-right' %}
      </a>
    </div>

    {%- if section.settings.sticker_cta != blank -%}
      <div class="recipient-sticker recipient-sticker--cta">
        <img src="{{ section.settings.sticker_cta | image_url: width: 120 }}" alt="" loading="lazy">
      </div>
    {%- endif -%}
  </div>

</section>

{% schema %}
{
  "name": "Seleccion de Ocasion",
  "tag": "section",
  "class": "section-recipient-occasions",
  "settings": [
    {
      "type": "header",
      "content": "Configuración del destinatario"
    },
    {
      "type": "select",
      "id": "recipient_type",
      "label": "Tipo de destinatario",
      "options": [
        { "value": "para-ella", "label": "Para Ella" },
        { "value": "para-el", "label": "Para Él" }
      ],
      "default": "para-ella"
    },
    {
      "type": "header",
      "content": "Hero"
    },
    {
      "type": "image_picker",
      "id": "hero_image",
      "label": "Imagen del hero"
    },
    {
      "type": "text",
      "id": "tag_text",
      "label": "Texto del tag",
      "default": "Regalos especiales"
    },
    {
      "type": "text",
      "id": "headline",
      "label": "Título principal",
      "default": "Regalos para ella"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Subtítulo",
      "default": "¿Cuál es la ocasión especial?"
    },
    {
      "type": "header",
      "content": "Ocasiones"
    },
    {
      "type": "text",
      "id": "occasions_title",
      "label": "Título de sección de ocasiones",
      "default": "Elige la ocasión"
    },
    {
      "type": "header",
      "content": "Ver todo"
    },
    {
      "type": "text",
      "id": "see_all_text",
      "label": "Texto sobre el botón",
      "default": "¿No encuentras la ocasión? No te preocupes."
    },
    {
      "type": "header",
      "content": "Stickers decorativos"
    },
    {
      "type": "image_picker",
      "id": "sticker_hero",
      "label": "Sticker Hero"
    },
    {
      "type": "image_picker",
      "id": "sticker_occasions",
      "label": "Sticker Ocasiones"
    },
    {
      "type": "image_picker",
      "id": "sticker_cta",
      "label": "Sticker CTA"
    }
  ],
  "blocks": [
    {
      "type": "occasion",
      "name": "Ocasión",
      "settings": [
        {
          "type": "text",
          "id": "tag_value",
          "label": "Valor del tag",
          "info": "Sin prefijo. Ej: cumpleanos"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Etiqueta visible",
          "default": "Cumpleaños"
        },
        {
          "type": "image_picker",
          "id": "icon_image",
          "label": "Icono (imagen)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Seleccion de Ocasion",
      "settings": {
        "recipient_type": "para-ella",
        "headline": "Regalos para ella",
        "subtitle": "¿Cuál es la ocasión especial?"
      },
      "blocks": [
        { "type": "occasion", "settings": { "tag_value": "cumpleanos", "label": "Cumpleaños" } },
        { "type": "occasion", "settings": { "tag_value": "san-valentin", "label": "San Valentín" } },
        { "type": "occasion", "settings": { "tag_value": "dia-de-las-madres", "label": "Día de las Madres" } },
        { "type": "occasion", "settings": { "tag_value": "aniversario", "label": "Aniversario" } },
        { "type": "occasion", "settings": { "tag_value": "navidad", "label": "Navidad" } },
        { "type": "occasion", "settings": { "tag_value": "graduacion", "label": "Graduación" } },
        { "type": "occasion", "settings": { "tag_value": "baby-shower", "label": "Baby Shower" } },
        { "type": "occasion", "settings": { "tag_value": "porque-si", "label": "Porque sí" } }
      ]
    }
  ]
}
{% endschema %}
