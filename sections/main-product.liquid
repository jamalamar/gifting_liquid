<section class="product-page" data-section-id="{{ section.id }}">
  <div class="container">
    <div class="product-page__wrapper">

      <!-- Product Media -->
      <div class="product-page__media">
        <div class="product-page__image-wrapper">
          {%- if product.featured_media -%}
            <div class="product-page__image">
              <img
                src="{{ product.featured_media | image_url: width: 800 }}"
                alt="{{ product.featured_media.alt | default: product.title }}"
                width="800"
                height="800"
                loading="eager"
                data-main-image
              >
            </div>
          {%- endif -%}

          {%- if product.available == false -%}
            <span class="product-page__badge product-page__badge--soldout collage-sticker">Agotado</span>
          {%- elsif product.compare_at_price > product.price -%}
            {%- assign discount = product.compare_at_price | minus: product.price | times: 100.0 | divided_by: product.compare_at_price | round -%}
            <span class="product-page__badge product-page__badge--sale collage-sticker">-{{ discount }}%</span>
          {%- endif -%}
        </div>

        {%- if product.media.size > 1 -%}
          <div class="product-page__thumbnails">
            {%- for media in product.media -%}
              <button
                type="button"
                class="product-page__thumb{% if forloop.first %} is-active{% endif %}"
                data-thumbnail
                data-media-id="{{ media.id }}"
                data-src="{{ media | image_url: width: 800 }}"
                aria-label="Ver imagen {{ forloop.index }}"
              >
                <img
                  src="{{ media | image_url: width: 150 }}"
                  alt="{{ media.alt | default: product.title }}"
                  width="70"
                  height="70"
                  loading="lazy"
                >
              </button>
            {%- endfor -%}
          </div>
        {%- endif -%}
      </div>

      <!-- Product Details -->
      <div class="product-page__details">
        {%- if product.vendor -%}
          <p class="product-page__vendor">{{ product.vendor }}</p>
        {%- endif -%}

        <h1 class="product-page__title">{{ product.title }}</h1>

        <div class="product-page__price">
          {%- if product.compare_at_price > product.price -%}
            <span class="product-page__price-compare">{{ product.compare_at_price | money }}</span>
          {%- endif -%}
          <span class="product-page__price-current">{{ product.price | money }}</span>
        </div>

        {%- if product.metafields.custom.short_description != blank -%}
          <p class="product-page__description-short">{{ product.metafields.custom.short_description }}</p>
        {%- endif -%}

        <!-- Product Form -->
        <form
          action="{{ routes.cart_add_url }}"
          method="post"
          class="product-page__form"
          id="product-form-{{ section.id }}"
          data-product-form
        >
          <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}" data-variant-id>

          {%- unless product.has_only_default_variant -%}
            <div class="product-page__variants">
              {%- for option in product.options_with_values -%}
                <div class="product-page__option">
                  <label class="product-page__option-label">{{ option.name }}</label>
                  <div class="product-page__option-values">
                    {%- for value in option.values -%}
                      <button
                        type="button"
                        class="product-page__option-btn{% if option.selected_value == value %} is-selected{% endif %}"
                        data-option-selector
                        data-option-name="{{ option.name }}"
                        data-option-value="{{ value }}"
                        aria-pressed="{% if option.selected_value == value %}true{% else %}false{% endif %}"
                      >
                        {{ value }}
                      </button>
                    {%- endfor -%}
                  </div>
                </div>
              {%- endfor -%}
            </div>
          {%- endunless -%}

          <div class="product-page__quantity">
            <label class="product-page__option-label">Cantidad</label>
            <div class="product-page__qty-group">
              <button type="button" class="product-page__qty-btn" data-quantity-minus aria-label="Disminuir cantidad">
                <span>−</span>
              </button>
              <input
                type="number"
                name="quantity"
                value="1"
                min="1"
                class="product-page__qty-input"
                data-quantity-input
                aria-label="Cantidad"
              >
              <button type="button" class="product-page__qty-btn" data-quantity-plus aria-label="Aumentar cantidad">
                <span>+</span>
              </button>
            </div>
          </div>

          <button
            type="submit"
            class="product-page__add-btn btn btn--primary"
            {% unless product.available %}disabled{% endunless %}
            data-add-to-cart
          >
            <span class="product-page__add-btn-text">
              {%- if product.available -%}
                {% render 'icon-cart' %}
                <span>Agregar a mi caja</span>
              {%- else -%}
                <span>Agotado</span>
              {%- endif -%}
            </span>
            <span class="product-page__add-btn-spinner" aria-hidden="true">
              <svg class="spinner" viewBox="0 0 24 24" width="20" height="20">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-dasharray="60" stroke-dashoffset="20"/>
              </svg>
            </span>
          </button>

          <div class="product-page__message" data-add-message></div>
        </form>

        {%- if section.settings.show_gift_message -%}
          <div class="product-page__gift-note">
            <span class="product-page__gift-note-icon">{% render 'icon-gift' %}</span>
            <p>{{ section.settings.gift_message | default: '¿Es un regalo? Agrega un mensaje personalizado en el carrito' }}</p>
          </div>
        {%- endif -%}

        {%- if product.description != blank -%}
          <div class="product-page__description">
            <h2 class="product-page__description-title">Descripcion</h2>
            <div class="product-page__description-content rte">
              {{ product.description }}
            </div>
          </div>
        {%- endif -%}

        {%- if product.tags.size > 0 -%}
          <div class="product-page__tags">
            {%- for tag in product.tags -%}
              <a href="{{ routes.collections_url }}/all/{{ tag | handle }}" class="product-page__tag collage-sticker collage-sticker--small">
                {{ tag }}
              </a>
            {%- endfor -%}
          </div>
        {%- endif -%}
      </div>

    </div>
  </div>
</section>

<script type="application/json" data-product-json>
  {{ product | json }}
</script>

{% schema %}
{
  "name": "Producto principal",
  "tag": "section",
  "class": "section-main-product",
  "settings": [
    {
      "type": "checkbox",
      "id": "show_gift_message",
      "label": "Mostrar nota de regalo",
      "default": true
    },
    {
      "type": "text",
      "id": "gift_message",
      "label": "Mensaje de regalo",
      "default": "¿Es un regalo? Agrega un mensaje personalizado en el carrito"
    }
  ]
}
{% endschema %}
