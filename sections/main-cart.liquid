<section class="cart-page" data-section-id="{{ section.id }}">
  <div class="container">
    <h1 class="cart-page__title">Tu Carrito</h1>

    {%- if cart.item_count > 0 -%}
      <div class="cart-page__wrapper">

        <!-- Cart Items -->
        <div class="cart-page__main">
          <form action="{{ routes.cart_url }}" method="post" class="cart-page__form" id="cart-form" data-cart-form>
            <div class="cart-page__items">
              {%- for item in cart.items -%}
                <div class="cart-page__item" data-cart-item data-key="{{ item.key }}">
                  <div class="cart-page__item-image">
                    {%- if item.image -%}
                      <a href="{{ item.url }}">
                        <img
                          src="{{ item.image | image_url: width: 200 }}"
                          alt="{{ item.title }}"
                          width="100"
                          height="100"
                          loading="lazy"
                        >
                      </a>
                    {%- else -%}
                      <div class="cart-page__item-placeholder">
                        {% render 'icon-gift' %}
                      </div>
                    {%- endif -%}
                  </div>

                  <div class="cart-page__item-details">
                    <h3 class="cart-page__item-title">
                      <a href="{{ item.url }}">{{ item.product.title }}</a>
                    </h3>
                    {%- unless item.product.has_only_default_variant -%}
                      <p class="cart-page__item-variant">{{ item.variant.title }}</p>
                    {%- endunless -%}
                    {%- if item.vendor -%}
                      <p class="cart-page__item-vendor">{{ item.vendor }}</p>
                    {%- endif -%}
                  </div>

                  <div class="cart-page__item-quantity">
                    <div class="cart-page__qty-group">
                      <button type="button" class="cart-page__qty-btn" data-quantity-minus data-key="{{ item.key }}" aria-label="Disminuir cantidad">
                        <span>âˆ’</span>
                      </button>
                      <input
                        type="number"
                        name="updates[]"
                        value="{{ item.quantity }}"
                        min="0"
                        class="cart-page__qty-input"
                        data-quantity-input
                        data-key="{{ item.key }}"
                        aria-label="Cantidad"
                      >
                      <button type="button" class="cart-page__qty-btn" data-quantity-plus data-key="{{ item.key }}" aria-label="Aumentar cantidad">
                        <span>+</span>
                      </button>
                    </div>
                  </div>

                  <div class="cart-page__item-price">
                    {%- if item.original_line_price != item.final_line_price -%}
                      <span class="cart-page__item-price-compare">{{ item.original_line_price | money }}</span>
                    {%- endif -%}
                    <span class="cart-page__item-price-current">{{ item.final_line_price | money }}</span>
                  </div>

                  <button type="button" class="cart-page__item-remove" data-remove-item data-key="{{ item.key }}" aria-label="Eliminar {{ item.product.title }}">
                    {% render 'icon-close' %}
                  </button>
                </div>
              {%- endfor -%}
            </div>
          </form>
        </div>

        <!-- Sidebar -->
        <div class="cart-page__sidebar">
          <!-- Summary -->
          <div class="cart-page__summary">
            <h2 class="cart-page__summary-title">Resumen</h2>

            <div class="cart-page__summary-row">
              <span>Subtotal</span>
              <span data-cart-subtotal>{{ cart.total_price | money }}</span>
            </div>

            {%- if cart.cart_level_discount_applications.size > 0 -%}
              {%- for discount in cart.cart_level_discount_applications -%}
                <div class="cart-page__summary-row cart-page__summary-row--discount">
                  <span>{{ discount.title }}</span>
                  <span>-{{ discount.total_allocated_amount | money }}</span>
                </div>
              {%- endfor -%}
            {%- endif -%}

            {%- assign free_shipping_threshold = settings.free_shipping_threshold | plus: 0 -%}
            {%- if free_shipping_threshold > 0 -%}
              <div class="cart-page__shipping">
                {%- assign threshold = free_shipping_threshold | times: 100 -%}
                {%- assign remaining = threshold | minus: cart.total_price -%}
                {%- assign progress = cart.total_price | times: 100.0 | divided_by: threshold -%}
                {%- if progress > 100 -%}{%- assign progress = 100 -%}{%- endif -%}

                {%- if remaining > 0 -%}
                  <p class="cart-page__shipping-text">
                    {% render 'icon-truck' %}
                    <span>Te faltan <strong>{{ remaining | money }}</strong> para envio gratis</span>
                  </p>
                {%- else -%}
                  <p class="cart-page__shipping-text cart-page__shipping-text--free">
                    {% render 'icon-check' %}
                    <span>Tienes envio gratis</span>
                  </p>
                {%- endif -%}

                <div class="cart-page__shipping-bar">
                  <div class="cart-page__shipping-progress" style="width: {{ progress }}%"></div>
                </div>
              </div>
            {%- endif -%}

            <div class="cart-page__summary-total">
              <span>Total</span>
              <span data-cart-total>{{ cart.total_price | money }}</span>
            </div>

            <p class="cart-page__summary-note">Impuestos incluidos. Envio calculado en checkout.</p>
          </div>

          <!-- Gift Message -->
          <div class="cart-page__gift-note">
            <h3 class="cart-page__gift-title">
              {% render 'icon-gift' %}
              <span>Mensaje personalizado</span>
            </h3>
            <p class="cart-page__gift-desc">Lo incluiremos en una tarjeta con tu pedido</p>
            <textarea
              name="note"
              class="cart-page__gift-textarea"
              placeholder="Escribe tu mensaje aqui..."
              form="cart-form"
            >{{ cart.note }}</textarea>
          </div>

          <!-- Checkout -->
          <a href="{{ routes.checkout_url }}" class="btn btn--primary cart-page__checkout">
            Continuar al checkout
            {% render 'icon-arrow-right' %}
          </a>

          <a href="{{ routes.all_products_collection_url }}" class="cart-page__continue">
            {% render 'icon-arrow-left' %}
            <span>Seguir comprando</span>
          </a>
        </div>

      </div>
    {%- else -%}
      <!-- Empty Cart -->
      <div class="cart-page__empty">
        <div class="cart-page__empty-icon">
          {% render 'icon-cart' %}
        </div>
        <h2 class="cart-page__empty-title">Tu carrito esta vacio</h2>
        <p class="cart-page__empty-text">Explora nuestros productos y encuentra el regalo perfecto.</p>
        <a href="{{ routes.all_products_collection_url }}" class="btn btn--primary cart-page__empty-btn">
          Explorar productos
          {% render 'icon-arrow-right' %}
        </a>
      </div>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "Carrito principal",
  "tag": "section",
  "class": "section-main-cart",
  "settings": []
}
{% endschema %}
